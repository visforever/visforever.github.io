<!DOCTYPE html>
<!-- Refer to url=https://yetanmoney.com/ Thanks a lot, upperclassman!-->
<html lang="zh-CN">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Note Details</title>

	<link rel="stylesheet" id="wp-block-library-css"
		href="../../blog/blogCSS/wp-includes.css.dist.block-library.style.min.css" type="text/css" media="all">
	<link rel="stylesheet" id="type-fonts-css" href="../../blog/blogCSS/t-font.css" type="text/css" media="all">
	<link rel="stylesheet" id="type-material-icons-css" href="../../blog/blogCSS/icon.css" type="text/css" media="all">
	<link rel="stylesheet" id="type-social-icons-css"
		href="../../blog/blogCSS/wp-content.themes.type-plus.fonts.socicon.min.css" type="text/css" media="all">
	<link rel="stylesheet" id="type-style-css" href="../../blog/blogCSS/wp-content.themes.type-plus.style.css"
		type="text/css" media="all">

	<!--MarkDown: https://maxiang.io/ 转换为html后，下载的css---->
	<link rel="stylesheet" href="../../assets/markdownStyle/marxico ver1.0.css">

	<!--Code 美化下载的css-->
	<link rel="stylesheet" type="text/css" href="../../assets/google-code-prettify/skins/desert.css">


	<link rel="stylesheet" id="type-blocks-style-css"
		href="../../blog/blogCSS/wp-content.themes.type-plus.inc.css.blocks.css" type="text/css" media="all">
	<link rel="stylesheet" id="type-slider-css-css"
		href="../../blog/blogCSS/wp-content.themes.type-plus.inc.slick.slick.min.css" type="text/css" media="all">
	<link rel="stylesheet" id="jetpack_css-css" href="../../blog/blogCSS/wp-content.plugins.jetpack.css.jetpack.css"
		type="text/css" media="all">

	<script type="text/javascript" src="../../blog/blogJS/wp-includes.js.jquery.jquery.js"></script>
	<script type="text/javascript" src="../../blog/blogJS/wp-includes.js.jquery.jquery-migrate.min.js"></script>
	
	<link rel="stylesheet" id="type-style-inline-css" href="../../blog/blogCSS/belowMeta01.css" type="text/css" media="all">
	<link rel="stylesheet" href="../../blog/blogCSS/belowMeta02.css" type="text/css" media="all">
	<link rel="stylesheet" href="../../blog/blogCSS/belowMeta03.css" type="text/css" media="all">
	<link rel="stylesheet" href="../../blog/blogCSS/belowMeta04.css" type="text/css" media="all">
	<link rel="stylesheet" href="../../blog/blogCSS/belowMeta05.css" type="text/css" media="all">
	<link rel="stylesheet" href="../../blog/blogCSS/belowMeta06.css" type="text/css" media="all">

	<link rel="shortcut icon" href="../../blog/favicon.ico?fit=32%2C32&amp;ssl=1" sizes="32x32">
	<link rel="icon" href="../../blog/favicon.ico?fit=32%2C32&amp;ssl=1" sizes="32x32">
	<link rel="icon" href="../../blog/favicon2.png?fit=192%2C192&amp;ssl=1" sizes="192x192">
	<link rel="shortcut icon" href="../../blog/favicon4.png?fit=192%2C192&amp;ssl=1" sizes="192x192">

	<link rel="apple-touch-icon-precomposed" href="../../blog/favicon3.png?fit=180%2C180&amp;ssl=1">

	<meta name="msapplication-TileImage" content="../../blog/favicon4.png?fit=270%2C270&amp;ssl=1">


	</head>

<!--重要，class不一样，后面影响样式，比如class:single对 entry-meta 影响间距-->

<body onload="PR.prettyPrint()"
	class="home blog  post-template-default single single-post single-format-standard wp-custom-logo fimg-classic hfeed header-layout2 content-sidebar">

	<div id="page" class="site">

		<header id="masthead" class="site-header has-header-image">

			<div class="home-site-title-centered">

				<div class="site-branding">
					<h1 class="site-title site-logo">
						<a href="#" class="custom-logo-link" rel="home">
							<img height="50" width="50" src="../../blog/favicon.ico" class="custom-logo" alt="ALTTAO">
						</a>
					</h1>

					<p class="site-description">能登上金字塔的生物只有两种 - 鹰和蜗牛</p>
					<p class="site-description">There are only two creatures who can surmount the pyramids - the eagle and the snail.</p>
					
				</div><!-- #site-branding -->

				<!-- #header bg-image -->
				<div class="header-image" style="background-image:url('../../blog/blog bg/blogbg6.jpg')"></div>

				<!-- 也可以用
					<div style="height:400px; background-image:url('../../blog/blog bg/blogbg3.jpg');"></div>
				-->


			</div>

		</header><!-- #masthead -->


		<div id="content" class="site-content">
			<div class="container">
				<!--控制container的空间分布文件在wp-content.themes.type-plus.style.css，搜索：/*tao即可-->
				<div class="inside">

					<div id="primary" class="content-area">
						<main id="main" class="site-main">

							<article id="post-2676"
								class="post-2676 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">


								<header class="entry-header">
									<h1 class="entry-title">
										<!--第1/3处修改(1)：p-->
										<!--此处要修改blog标题-->
										<span>多进程获取关键词（Callback DP05多线程）</span>
									</h1>
									<div class="entry-meta">
										<span class="byline">
											<span class="author vcard">

												<span class="screen-reader-text">Author</span>
												<a class="url fn n" href="https://tideal.github.io/">tao</a>

											</span>
											&nbsp;&nbsp;
											<!--第2/3处修改(1)：p-->
											<!--此处要修改blog标题-->
											<time>Sept. 2022</time>
										</span>

									</div>
								</header>
								<!-- .entry-header -->


								<div class="entry-content">
								<!--第3/3处修改(段)：p-->
								<!--此处要修改blog标题-->

									
									<!--1. 标题移动到上面-->
									<!--2. 代码块，单独处理一下-->
									
									<!--Markdown内容开始((((-->
	

<div id='preview-contents' class='note-content'>
                        
                    

<p><em>Call back</em> <a href="https://nbviewer.org/github/visforever/visforever.github.io/blob/main/SNS_prj01_weibo0331/notes/DataProcessing05_2_getWordFreq.ipynb%22" target="_blank">DP05 处理新字段 - kWords</a></p>

<blockquote>
  <p><strong>多进程程序</strong>：多进程无法在Jupyter Notebook中运行，所以这里存放PyCharm的运行代码。</p>
</blockquote>

<p><strong>本程序注意点</strong>：</p>

<ul><li><p><strong>待处理程序具有返回值怎么办？</strong> ：执行多进程的代码块前面，定义的变量<code>res</code>是用于处理带有返回值<code>return</code>语句的变量；</p></li>
<li><p><strong>返回值无法pickle到本地怎么办？</strong> ：<code>pickle</code>序列化的对象具有一定的要求，本程序直接<code>pickle</code>时报错，<code>无法pickle"lock"对象</code>，所以这里我们多了一步赋值语句，解决了这个问题。</p></li>
</ul>

<hr>



<h4 id="运行代码">运行代码</h4>



<pre class="prettyprint hljs-dark"><code class="language-python hljs"><div class="hljs-line"><span class="hljs-keyword">import</span> pickle
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line"><span class="hljs-comment"># Input: 变量名，保存路径</span>
</div><div class="hljs-line"><span class="hljs-comment"># Output: 保存路径</span>
</div><div class="hljs-line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_variable1</span><span class="hljs-params">(v, filename)</span>:</span>
</div><div class="hljs-line">    f = open(filename, <span class="hljs-string">'wb'</span>)
</div><div class="hljs-line">    pickle.dump(v, f, <span class="hljs-number">0</span>)  <span class="hljs-comment"># 在dump()里加上第三个参数，设为0(ASCII协议).</span>
</div><div class="hljs-line">    f.close()
</div><div class="hljs-line">    <span class="hljs-keyword">return</span> filename
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line"><span class="hljs-comment"># Input: 保存的变量路径</span>
</div><div class="hljs-line"><span class="hljs-comment"># Output: 变量</span>
</div><div class="hljs-line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_variable1</span><span class="hljs-params">(filename)</span>:</span>
</div><div class="hljs-line">    f = open(filename, <span class="hljs-string">'rb'</span>)
</div><div class="hljs-line">    r = pickle.load(f)
</div><div class="hljs-line">    f.close()
</div><div class="hljs-line">    <span class="hljs-keyword">return</span> r
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_variable2</span><span class="hljs-params">(v, filename)</span>:</span>
</div><div class="hljs-line">    <span class="hljs-keyword">try</span>:
</div><div class="hljs-line">        <span class="hljs-comment"># f = open('test001.txt','w',encoding='utf-8') #open 打开要写入的文件，'w'就是写入的意思，如果有中文encoding进行编码</span>
</div><div class="hljs-line">        <span class="hljs-keyword">with</span> open(filename,<span class="hljs-string">'w'</span>,encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
</div><div class="hljs-line">            f.write(v)  <span class="hljs-comment"># write是写入的意思，将（）中的内容写入到f文件里</span>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    <span class="hljs-comment"># 无论try中的程序是否存在报错，则都执行下面的关闭</span>
</div><div class="hljs-line">    <span class="hljs-keyword">finally</span>:
</div><div class="hljs-line">        <span class="hljs-keyword">if</span> f:  <span class="hljs-comment"># 判断下f是否打开了，如果没打开则不需要关闭，打开了则关闭</span>
</div><div class="hljs-line">            f.close()
</div><div class="hljs-line">    <span class="hljs-keyword">return</span> filename
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_variable2</span><span class="hljs-params">(filename)</span>:</span>
</div><div class="hljs-line">    <span class="hljs-comment"># 首先try一下，如果程序打开以及在打开后读取一系列操作后有报错，则不中断程序</span>
</div><div class="hljs-line">    <span class="hljs-keyword">try</span>:
</div><div class="hljs-line">        <span class="hljs-comment"># f = open(filename, 'r', encoding='utf-8')</span>
</div><div class="hljs-line">        <span class="hljs-keyword">with</span> open(filename, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
</div><div class="hljs-line">            strContent = f.read()
</div><div class="hljs-line">    <span class="hljs-comment"># 无论try中的程序是否存在报错，则都执行下面的关闭</span>
</div><div class="hljs-line">    <span class="hljs-keyword">finally</span>:
</div><div class="hljs-line">        <span class="hljs-keyword">if</span> f:  <span class="hljs-comment"># 判断下f是否打开了，如果没打开则不需要关闭，打开了则关闭</span>
</div><div class="hljs-line">            f.close()
</div><div class="hljs-line">    <span class="hljs-keyword">return</span> strContent
</div><div class="hljs-line"><wbr>
</div></code></pre>



<pre class="prettyprint hljs-dark"><code class="language-python hljs"><div class="hljs-line"><span class="hljs-keyword">import</span> pymongo
</div><div class="hljs-line"><span class="hljs-keyword">import</span> time
</div><div class="hljs-line"><span class="hljs-keyword">import</span> os  <span class="hljs-comment"># ▲</span>
</div><div class="hljs-line"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool
</div><div class="hljs-line"><span class="hljs-keyword">import</span> re
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line"><span class="hljs-comment"># ▲ 加了一个进程的名字</span>
</div><div class="hljs-line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">computeWordFreq_pro</span><span class="hljs-params">(curCol, targetDB, targetCol, per = <span class="hljs-number">1.0</span>)</span>:</span>
</div><div class="hljs-line">    loc = locals()
</div><div class="hljs-line">    db = pymongo.MongoClient(<span class="hljs-string">"localhost:27017"</span>, serverSelectionTimeoutMS=<span class="hljs-number">10000</span>)
</div><div class="hljs-line">    exec(targetDB + <span class="hljs-string">" = db['"</span> + targetDB + <span class="hljs-string">"']"</span>)
</div><div class="hljs-line">    print(targetDB + <span class="hljs-string">": 已连接！"</span>)
</div><div class="hljs-line">    print(f<span class="hljs-string">"我是{curCol}子进程，我的进程号为{os.getpid()}，我开始执行了..."</span>)  <span class="hljs-comment"># ▲</span>
</div><div class="hljs-line">    exec(targetCol + <span class="hljs-string">" = "</span> + targetDB + <span class="hljs-string">"['"</span> + targetCol + <span class="hljs-string">"']"</span>)
</div><div class="hljs-line">    exec(<span class="hljs-string">"recs = "</span> + targetCol + <span class="hljs-string">".find()"</span>)
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    tempCnt_Words = <span class="hljs-number">0</span>  <span class="hljs-comment"># ●1 存放当前集合中的词的总数</span>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    freqWords = {}  <span class="hljs-comment"># key(词汇)，value(词频数)</span>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    <span class="hljs-keyword">for</span> cW <span class="hljs-keyword">in</span> loc[<span class="hljs-string">'recs'</span>]:
</div><div class="hljs-line">        <span class="hljs-comment"># 手动写词频统计函数，基于字典实现</span>
</div><div class="hljs-line">        currentContent = cW.get(<span class="hljs-string">'kWords'</span>)
</div><div class="hljs-line">        tempCnt_Words = tempCnt_Words + len(currentContent)  <span class="hljs-comment"># 存放当前集合中关键词的总数量</span>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">        <span class="hljs-keyword">for</span> eachWord <span class="hljs-keyword">in</span> currentContent:
</div><div class="hljs-line">            freqWords[eachWord] = freqWords.get(eachWord, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>  <span class="hljs-comment"># 统计每个关键词的词频</span>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    items = list(freqWords.items())  <span class="hljs-comment"># 转换为list</span>
</div><div class="hljs-line">    total_num = len(items)  <span class="hljs-comment"># ●2 不一样的词的个数</span>
</div><div class="hljs-line">    <span class="hljs-comment"># print("items.len = " + str(total_num)）  # ●2 不一样的词的个数</span>
</div><div class="hljs-line">    items.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-keyword">True</span>)  <span class="hljs-comment"># 按照词频排序</span>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    topK = int(total_num * per)
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    wordcloudDic = dict()  <span class="hljs-comment"># ●3 存放前k个词 &amp; 词频</span>
</div><div class="hljs-line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(topK):
</div><div class="hljs-line">        word, count = items[i]
</div><div class="hljs-line">        wordcloudDic[word] = count
</div><div class="hljs-line">        <span class="hljs-comment"># print("{0:&lt;20}{1:&gt;10}".format(word, count))</span>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    res = list()
</div><div class="hljs-line">    res.append(targetCol)
</div><div class="hljs-line">    res.append(tempCnt_Words)
</div><div class="hljs-line">    res.append(len(items))
</div><div class="hljs-line">    res.append(wordcloudDic)
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    print(f<span class="hljs-string">"我是{curCol}子进程，我执行完了！"</span>)  <span class="hljs-comment"># ▲</span>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    <span class="hljs-keyword">return</span> res
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    targetDB = <span class="hljs-string">'db_Weibo_SH0331'</span>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    startTime = time.time()
</div><div class="hljs-line">    print(time.strftime(<span class="hljs-string">'%Y-%m-%d %H:%M:%S'</span>, time.localtime(startTime)))
</div><div class="hljs-line">    <span class="hljs-comment"># 开始处理----↓</span>
</div><div class="hljs-line">    patternNum = <span class="hljs-string">'[0-9]+'</span>
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    <span class="hljs-comment"># 循环处理24个集合</span>
</div><div class="hljs-line">    subCol24 = list()
</div><div class="hljs-line">    subCol24.append([<span class="hljs-string">"col_weibo_timePeriod_"</span> + str(period) <span class="hljs-keyword">for</span> period <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, <span class="hljs-number">24</span>)])
</div><div class="hljs-line">    colPackages = subCol24[<span class="hljs-number">0</span>]
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    per = <span class="hljs-number">0.2</span>
</div><div class="hljs-line">    p = Pool(<span class="hljs-number">5</span>)
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    res = list()
</div><div class="hljs-line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>, len(colPackages)):
</div><div class="hljs-line">        post = re.search(patternNum, colPackages[i]).group()
</div><div class="hljs-line">        res.append(p.apply_async(computeWordFreq_pro, args=(<span class="hljs-string">'col'</span> + post, targetDB, colPackages[i], per)))
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    print(<span class="hljs-string">'Waiting for all subprocesses done...'</span>)
</div><div class="hljs-line">    p.close()
</div><div class="hljs-line">    p.join()
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    <span class="hljs-string">'''</span>
</div><div class="hljs-line"><span class="hljs-string">    process_list = []    # 存放开启的进程</span>
</div><div class="hljs-line"><span class="hljs-string">    for i in range(0, len(colPackages)):</span>
</div><div class="hljs-line"><span class="hljs-string">        post = re.search(patternNum, colPackages[i]).group()</span>
</div><div class="hljs-line"><span class="hljs-string">        # 进程中的参数args表示调用对象的位置参数元组.注意：元组中只有一个元素时结尾要加","逗号</span>
</div><div class="hljs-line"><span class="hljs-string">        p = Process(target=filterSentences, args=('col' + post, targetDB, colPackages[i], fields))</span>
</div><div class="hljs-line"><span class="hljs-string">        p.start()</span>
</div><div class="hljs-line"><span class="hljs-string">        print('------&gt; Thread id : %d' % p.ident)  # 进程id</span>
</div><div class="hljs-line"><span class="hljs-string">        print('------&gt; Thread name : %s' % p.name)  # 进程name</span>
</div><div class="hljs-line"><span class="hljs-string">        process_list.append(p)</span>
</div><div class="hljs-line"><span class="hljs-string">    for i in process_list:</span>
</div><div class="hljs-line"><span class="hljs-string">        i.join()    # 阻塞每个子进程，主进程会等待所有子进程结束再结束主进程</span>
</div><div class="hljs-line"><span class="hljs-string">    '''</span>
</div><div class="hljs-line">    print(<span class="hljs-string">"主进程结束！"</span>)
</div><div class="hljs-line">    <span class="hljs-comment"># 结束处理----↑</span>
</div><div class="hljs-line">    endTime = time.time()
</div><div class="hljs-line">    print(time.strftime(<span class="hljs-string">'%Y-%m-%d %H:%M:%S'</span>, time.localtime(endTime)))
</div><div class="hljs-line">    print(<span class="hljs-string">"Time consuming(s): %.2f"</span> % (endTime - startTime))
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    wordFreqDict_MulPro = dict()
</div><div class="hljs-line">    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> res:
</div><div class="hljs-line">        content = r.get()
</div><div class="hljs-line">        <span class="hljs-comment"># print(content)</span>
</div><div class="hljs-line">        <span class="hljs-comment"># ['col_weibo_timePeriod_0', 1305921, 36127, {'疫情': 47415, '医院': 40077, '小区': 38743, ...}]</span>
</div><div class="hljs-line">        wordFreqDict_MulPro[content[<span class="hljs-number">0</span>]] = content[<span class="hljs-number">1</span>:]
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">    print(type(wordFreqDict_MulPro))
</div><div class="hljs-line">    save_variable1(wordFreqDict_MulPro, <span class="hljs-string">'wordFreqDict_MulPro_WithType.txt'</span>)
</div><div class="hljs-line">    save_variable2(str(wordFreqDict_MulPro), <span class="hljs-string">'wordFreqDict_MulPro_WithoutType.txt'</span>)  <span class="hljs-comment"># 只能查看字符串</span>
</div><div class="hljs-line"><wbr>
</div></code></pre>



<h4 id="运行结果">运行结果</h4>



<pre class="prettyprint hljs-dark"><code class="language-bash hljs"><div class="hljs-line">2022-09-03 15:38:09
</div><div class="hljs-line">Waiting <span class="hljs-keyword">for</span> all subprocesses done...
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col2子进程，我的进程号为32420，我开始执行了...
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col0子进程，我的进程号为28736，我开始执行了...
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col4子进程，我的进程号为31112，我开始执行了...
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col3子进程，我的进程号为10556，我开始执行了...
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col1子进程，我的进程号为2524，我开始执行了...
</div><div class="hljs-line">我是col4子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col5子进程，我的进程号为31112，我开始执行了...
</div><div class="hljs-line">我是col3子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col6子进程，我的进程号为10556，我开始执行了...
</div><div class="hljs-line">我是col5子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col7子进程，我的进程号为31112，我开始执行了...
</div><div class="hljs-line">我是col2子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col8子进程，我的进程号为32420，我开始执行了...
</div><div class="hljs-line">我是col6子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col9子进程，我的进程号为10556，我开始执行了...
</div><div class="hljs-line">我是col1子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col10子进程，我的进程号为2524，我开始执行了...
</div><div class="hljs-line">我是col7子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col11子进程，我的进程号为31112，我开始执行了...
</div><div class="hljs-line">我是col0子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col12子进程，我的进程号为28736，我开始执行了...
</div><div class="hljs-line">我是col8子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col13子进程，我的进程号为32420，我开始执行了...
</div><div class="hljs-line">我是col9子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col14子进程，我的进程号为10556，我开始执行了...
</div><div class="hljs-line">我是col10子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col15子进程，我的进程号为2524，我开始执行了...
</div><div class="hljs-line">我是col12子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col16子进程，我的进程号为28736，我开始执行了...
</div><div class="hljs-line">我是col11子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col17子进程，我的进程号为31112，我开始执行了...
</div><div class="hljs-line">我是col14子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col18子进程，我的进程号为10556，我开始执行了...
</div><div class="hljs-line">我是col13子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col19子进程，我的进程号为32420，我开始执行了...
</div><div class="hljs-line">我是col15子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col20子进程，我的进程号为2524，我开始执行了...
</div><div class="hljs-line">我是col16子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col21子进程，我的进程号为28736，我开始执行了...
</div><div class="hljs-line">我是col17子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col22子进程，我的进程号为31112，我开始执行了...
</div><div class="hljs-line">我是col18子进程，我执行完了！
</div><div class="hljs-line">db_Weibo_SH0331: 已连接！
</div><div class="hljs-line">我是col23子进程，我的进程号为10556，我开始执行了...
</div><div class="hljs-line">我是col19子进程，我执行完了！
</div><div class="hljs-line">我是col20子进程，我执行完了！
</div><div class="hljs-line">我是col22子进程，我执行完了！
</div><div class="hljs-line">我是col21子进程，我执行完了！
</div><div class="hljs-line">我是col23子进程，我执行完了！
</div><div class="hljs-line">主进程结束！
</div><div class="hljs-line">2022-09-03 15:38:51
</div><div class="hljs-line">Time consuming(s): 42.13
</div><div class="hljs-line">&lt;class <span class="hljs-string">'dict'</span>&gt;
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">Process finished with <span class="hljs-built_in">exit</span> code 0
</div><div class="hljs-line"><wbr>
</div></code></pre>

<blockquote>
  <p><strong>对比发现</strong>，多进程速度有明显提升。</p>
  
  <ul><li><p>多进程耗时: <code>Time consuming(s): 42.13</code></p></li>
  <li><p>普通运行耗时: <code>Time consuming: 115.33</code></p></li>
  </ul>
</blockquote>

<p>处理得到的部分结果（文档内容展示）</p>



<pre class="prettyprint hljs-dark"><code class="hljs clean"><div class="hljs-line">{<span class="hljs-string">'col_weibo_timePeriod_0'</span>: [<span class="hljs-number">1305921</span>, <span class="hljs-number">36127</span>, {<span class="hljs-string">'疫情'</span>: <span class="hljs-number">47415</span>, <span class="hljs-string">'医院'</span>: <span class="hljs-number">40077</span>, <span class="hljs-string">'小区'</span>: <span class="hljs-number">38743</span>, <span class="hljs-string">'30'</span>: <span class="hljs-number">37617</span>, <span class="hljs-string">'病人'</span>: <span class="hljs-number">37557</span>, <span class="hljs-string">'2022'</span>: <span class="hljs-number">37474</span>, <span class="hljs-string">'120'</span>: <span class="hljs-number">37039</span>, <span class="hljs-string">'离世'</span>: <span class="hljs-number">36322</span>, <span class="hljs-string">'哮喘'</span>: <span class="hljs-number">36315</span>, <span class="hljs-string">'救治'</span>: <span class="hljs-number">36302</span>, <span class="hljs-string">'救助'</span>: <span class="hljs-number">36275</span>, <span class="hljs-string">'110'</span>: <span class="hljs-number">36208</span>, <span class="hljs-string">'救护车'</span>: <span class="hljs-number">36186</span>, <span class="hljs-string">'邻居'</span>: <span class="hljs-number">36181</span>, <span class="hljs-string">'发作'</span>: <span class="hljs-number">36126</span>, <span class="hljs-string">'阻拦'</span>: <span class="hljs-number">36124</span>, <span class="hljs-string">'804'</span>: <span class="hljs-number">36121</span>, <span class="hljs-string">'40'</span>: <span class="hljs-number">36083</span>, <span class="hljs-string">'202'</span>: <span class="hljs-number">35334</span>, <span class="hljs-string">'11'</span>: <span class="hljs-number">25890</span>, <span class="hljs-string">'上海'</span>: <span class="hljs-number">12816</span>, <span class="hljs-string">'核酸'</span>: <span class="hljs-number">7762</span>, <span class="hljs-string">'微博'</span>: <span class="hljs-number">7687</span>, <span class="hljs-string">'到达'</span>: <span class="hljs-number">7041</span>, <span class="hljs-string">'转发'</span>: <span class="hljs-number">5379</span>, <span class="hljs-string">'##'</span>: <span class="hljs-number">5114</span>, <span class="hljs-string">'新冠'</span>: <span class="hljs-number">4188</span>, <span class="hljs-string">'浦东'</span>: <span class="hljs-number">4043</span>, <span class="hljs-string">'封控'</span>: <span class="hljs-number">3782</span>, <span class="hljs-string">'筛查'</span>: <span class="hljs-number">3561</span>, <span class="hljs-string">'全域'</span>: <span class="hljs-number">3119</span>, <span class="hljs-string">'全员'</span>: <span class="hljs-number">3073</span>, <span class="hljs-string">'血透'</span>: <span class="hljs-number">2903</span>, <span class="hljs-string">'求助'</span>: <span class="hljs-number">2696</span>, <span class="hljs-string">'防疫'</span>: <span class="hljs-number">2544</span>, <span class="hljs-string">'静态'</span>: <span class="hljs-number">2513</span>, ..., <span class="hljs-string">'来得'</span>: <span class="hljs-number">6</span>}], 
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line"><span class="hljs-string">'col_weibo_timePeriod_1'</span>: [<span class="hljs-number">809348</span>, <span class="hljs-number">27751</span>, {<span class="hljs-string">'疫情'</span>: <span class="hljs-number">28547</span>, <span class="hljs-string">'医院'</span>: <span class="hljs-number">25508</span>, <span class="hljs-string">'小区'</span>: <span class="hljs-number">24719</span>, <span class="hljs-string">'120'</span>: <span class="hljs-number">24341</span>, <span class="hljs-string">'病人'</span>: <span class="hljs-number">23647</span>, <span class="hljs-string">'30'</span>: <span class="hljs-number">22599</span>, <span class="hljs-string">'救助'</span>: <span class="hljs-number">22472</span>, <span class="hljs-string">'2022'</span>: <span class="hljs-number">22432</span>, <span class="hljs-string">'离世'</span>: <span class="hljs-number">22317</span>, <span class="hljs-string">'哮喘'</span>: <span class="hljs-number">22290</span>, <span class="hljs-string">'救治'</span>: <span class="hljs-number">22192</span>, <span class="hljs-string">'邻居'</span>: <span class="hljs-number">22133</span>, <span class="hljs-string">'救护车'</span>: <span class="hljs-number">22119</span>, <span class="hljs-string">'110'</span>: <span class="hljs-number">22103</span>, <span class="hljs-string">'阻拦'</span>: <span class="hljs-number">22099</span>, <span class="hljs-string">'发作'</span>: <span class="hljs-number">22064</span>, <span class="hljs-string">'804'</span>: <span class="hljs-number">22058</span>, <span class="hljs-string">'40'</span>: <span class="hljs-number">21986</span>, <span class="hljs-string">'202'</span>: <span class="hljs-number">21506</span>, <span class="hljs-string">'11'</span>: <span class="hljs-number">16563</span>, <span class="hljs-string">'上海'</span>: <span class="hljs-number">10039</span>, <span class="hljs-string">'核酸'</span>: <span class="hljs-number">6037</span>, ...}], 
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line">...,
</div><div class="hljs-line"><wbr>
</div><div class="hljs-line"><span class="hljs-string">'col_weibo_timePeriod_23'</span>: [<span class="hljs-number">744825</span>, <span class="hljs-number">36738</span>, {<span class="hljs-string">'疫情'</span>: <span class="hljs-number">16786</span>, <span class="hljs-string">'上海'</span>: <span class="hljs-number">11156</span>, <span class="hljs-string">'微博'</span>: <span class="hljs-number">7294</span>, <span class="hljs-string">'核酸'</span>: <span class="hljs-number">7070</span>, <span class="hljs-string">'新冠'</span>: <span class="hljs-number">7063</span>, <span class="hljs-string">'小区'</span>: <span class="hljs-number">7033</span>, <span class="hljs-string">'120'</span>: <span class="hljs-number">6626</span>, <span class="hljs-string">'居委'</span>: <span class="hljs-number">6300</span>, <span class="hljs-string">'人员'</span>: <span class="hljs-number">6154</span>, <span class="hljs-string">'28'</span>: <span class="hljs-number">5544</span>, <span class="hljs-string">'我们'</span>: <span class="hljs-number">5465</span>, <span class="hljs-string">'救助'</span>: <span class="hljs-number">5080</span>, <span class="hljs-string">'不能'</span>: <span class="hljs-number">5000</span>, <span class="hljs-string">'抗疫'</span>: <span class="hljs-number">4881</span>, <span class="hljs-string">'30'</span>: <span class="hljs-number">4849</span>, <span class="hljs-string">'医生'</span>: <span class="hljs-number">4824</span>, <span class="hljs-string">'救护车'</span>: <span class="hljs-number">4793</span>, <span class="hljs-string">'大家'</span>: <span class="hljs-number">4787</span>, <span class="hljs-string">'16'</span>: <span class="hljs-number">4776</span>, <span class="hljs-string">'邻居'</span>: <span class="hljs-number">4760</span>, <span class="hljs-string">'看到'</span>: <span class="hljs-number">4444</span>, <span class="hljs-string">'父亲'</span>: <span class="hljs-number">4418</span>, <span class="hljs-string">'AED'</span>: <span class="hljs-number">4381</span>, <span class="hljs-string">'救援'</span>: <span class="hljs-number">4279</span>, <span class="hljs-string">'202'</span>: <span class="hljs-number">4221</span>, <span class="hljs-string">'上车'</span>: <span class="hljs-number">4208</span>, <span class="hljs-string">'病毒'</span>: <span class="hljs-number">4117</span>, <span class="hljs-string">'奥密克戎'</span>: <span class="hljs-number">3900</span>, <span class="hljs-string">'检测'</span>: <span class="hljs-number">3857</span>, <span class="hljs-string">'110'</span>: <span class="hljs-number">3756</span>, <span class="hljs-string">'XE'</span>: <span class="hljs-number">3596</span>, <span class="hljs-string">'阳性'</span>: <span class="hljs-number">3587</span>, <span class="hljs-string">'##'</span>: <span class="hljs-number">3579</span>, <span class="hljs-string">'31'</span>: <span class="hljs-number">3550</span>, <span class="hljs-string">'毒株'</span>: <span class="hljs-number">3527</span>, <span class="hljs-string">'转发'</span>: <span class="hljs-number">3410</span>, <span class="hljs-string">'BA.2'</span>: <span class="hljs-number">3409</span>, <span class="hljs-string">'传播速度'</span>: <span class="hljs-number">3376</span>, <span class="hljs-string">'变体'</span>: <span class="hljs-number">3365</span>, <span class="hljs-string">'10%'</span>: <span class="hljs-number">3365</span>, <span class="hljs-string">'重组'</span>: <span class="hljs-number">3360</span>, <span class="hljs-string">'637'</span>: <span class="hljs-number">3358</span>, <span class="hljs-string">'UKHSA'</span>: <span class="hljs-number">3292</span>, <span class="hljs-string">'封控'</span>: <span class="hljs-number">3290</span>, <span class="hljs-string">'医院'</span>: <span class="hljs-number">3221</span>, <span class="hljs-string">'奥密克'</span>: <span class="hljs-number">3219</span>, <span class="hljs-string">'戎子'</span>: <span class="hljs-number">3162</span>, <span class="hljs-string">'BA.1'</span>: <span class="hljs-number">3143</span>, <span class="hljs-string">'血透'</span>: <span class="hljs-number">3120</span>, <span class="hljs-string">'问能'</span>: <span class="hljs-number">3076</span>, <span class="hljs-string">'9.8%'</span>: <span class="hljs-number">2988</span>, <span class="hljs-string">'小时'</span>: <span class="hljs-number">2977</span>, <span class="hljs-string">'防控'</span>: <span class="hljs-number">2830</span>, <span class="hljs-string">'两种'</span>: <span class="hljs-number">2802</span>, <span class="hljs-string">'2022'</span>: <span class="hljs-number">2463</span>, <span class="hljs-string">'求助'</span>: <span class="hljs-number">2208</span>, <span class="hljs-string">'浦东'</span>: <span class="hljs-number">2142</span>, <span class="hljs-string">'24'</span>: <span class="hljs-number">2088</span>, <span class="hljs-string">'隔离'</span>: <span class="hljs-number">2086</span>, <span class="hljs-string">'20'</span>: <span class="hljs-number">2011</span>, <span class="hljs-string">'求求'</span>: <span class="hljs-number">1962</span>, <span class="hljs-string">'防疫'</span>: <span class="hljs-number">1915</span>, ..., <span class="hljs-string">'字号'</span>: <span class="hljs-number">6</span>}]}
</div></code>

</pre>

</div>

	
	
	
	
									<!--))))Markdown内容结束-->


								</div><!-- .entry-content -->

							</article><!-- #post-## -->

						</main><!-- #main -->

					</div>
					<!-- #primary -->



				</div><!-- .inside -->
			</div><!-- .container -->
		</div><!-- #content -->

		<footer id="colophon" class="site-footer">

			<aside class="widget-area">
				<div class="container">
					<div class="row">
						<div class="col-4 col-md-4" id="footer-area-1"></div>
						<div class="col-4 col-md-4" id="footer-area-2"></div>
						<div class="col-4 col-md-4" id="footer-area-3"></div>
					</div>
				</div><!-- .container -->
			</aside><!-- .widget-area -->


			<div class="footer-copy">
				<div class="container">

					<div class="row">
						<div class="col-6 col-sm-12">
							<div class="site-credits">
								© 2022 BesT.tao
							</div>
						</div>

						<div class="col-6 col-sm-12"></div>
					</div>

				</div><!-- .container -->
			</div><!-- .footer-copy -->

		</footer><!-- #colophon -->

		<a href="#masthead" id="scroll-up" style="display: block;">
			<i class="material-icons md-20 md-middle"></i>
		</a>

	</div><!-- #page -->

	<div style="display:none"></div>

	<script type="text/javascript"
		src="../../blog/blogJS/wp-content.plugins.jetpack._inc.build.photon.photon.min.js"></script>
	<script type="text/javascript" src="../../blog/blogJS/wp-content.js.devicepx-jetpack.js"></script>
	<script type="text/javascript" src="../../blog/blogJS/wp-content.themes.type-plus.js.main.js"></script>
	<script type="text/javascript" src="../../blog/blogJS/wp-content.themes.type-plus.inc.slick.slick.min.js"></script>
	<script type="text/javascript"
		src="../../blog/blogJS/wp-content.plugins.jetpack._inc.build.widgets.eu-cookie-law.eu-cookie-law.min.js"></script>

	<script type="text/javascript"
		src="../../blog/blogJS/wp-content.plugins.jetpack._inc.build.widgets.milestone.milestone.min.js"></script>
	<script type="text/javascript" src="../../blog/blogJS/wp-includes.js.wp-embed.min.js"></script>
	<script type="text/javascript" src="../../blog/blogJS/stats.wp.com.e-202110.js" async="async"
		defer="defer"></script>

	<!--代码美化-->
	<script src="../../assets/google-code-prettify/prettify.js"></script>

</body>
</html>